<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Endless Roads</title>

<meta name="viewport"
content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#000;
  touch-action:none;
  font-family:sans-serif;
}

#menu{
  position:fixed;
  inset:0;
  background:#87ceeb;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:20;
}

#menuBox{
  background:#fff;
  padding:20px;
  border-radius:12px;
  text-align:center;
}

#hud{
  position:fixed;
  top:10px;
  left:10px;
  color:#fff;
  z-index:10;
}

#mobile{
  position:fixed;
  bottom:10px;
  left:0;
  right:0;
  display:none;
  justify-content:space-between;
  padding:0 20px;
  z-index:10;
}

.mbtn{
  width:70px;
  height:70px;
  border-radius:50%;
  background:#000a;
  color:#fff;
  font-size:26px;
  border:none;
}
</style>
</head>

<body>

<div id="menu">
  <div id="menuBox">
    <h2>Endless Roads</h2>
    <button id="begin">BEGIN</button>
  </div>
</div>

<div id="hud">SPD <span id="spd">0</span></div>

<div id="mobile">
  <div>
    <button class="mbtn" id="left">◀</button>
    <button class="mbtn" id="right">▶</button>
  </div>
  <div>
    <button class="mbtn" id="brake">⛔</button>
    <button class="mbtn" id="gas">▲</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
/* DEVICE DETECT */
const isMobile=/Android|iPhone|iPad|Mobile/i.test(navigator.userAgent);
if(isMobile) document.getElementById("mobile").style.display="flex";

/* SCENE */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x87ceeb);

const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,0.1,1000);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

/* LIGHT */
scene.add(new THREE.HemisphereLight(0xffffff,0x444444,1.2));

/* TERRAIN */
const land=new THREE.Mesh(
  new THREE.PlaneGeometry(2000,2000),
  new THREE.MeshStandardMaterial({color:0x55cc55})
);
land.rotation.x=-Math.PI/2;
scene.add(land);

/* ROAD GROUP */
const roadGroup=new THREE.Group();
scene.add(roadGroup);

/* CURVED ROAD SEGMENTS */
const SEG=40;
for(let i=0;i<SEG;i++){
  const road=new THREE.Mesh(
    new THREE.PlaneGeometry(12,40),
    new THREE.MeshStandardMaterial({color:0x333333})
  );
  road.rotation.x=-Math.PI/2;
  road.position.z=-i*40;
  road.position.x=Math.sin(i*0.3)*6;
  roadGroup.add(road);

  /* GUARD RAILS */
  if(i%5!==0){
    ["L","R"].forEach(side=>{
      const rail=new THREE.Mesh(
        new THREE.BoxGeometry(0.5,1,40),
        new THREE.MeshStandardMaterial({color:0xaaaaaa})
      );
      rail.position.z=road.position.z;
      rail.position.x=road.position.x+(side==="L"?-6.5:6.5);
      rail.position.y=0.5;
      roadGroup.add(rail);
    });
  }
}

/* CAR */
const car=new THREE.Mesh(
  new THREE.BoxGeometry(1.6,0.6,3.2),
  new THREE.MeshStandardMaterial({color:0xffffff})
);
car.position.y=0.35;
scene.add(car);

/* INPUT */
let gas=false, brake=false, left=false, right=false;
let keys={};

addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

function bind(id,fn){
  const el=document.getElementById(id);
  el.addEventListener("pointerdown",e=>{e.preventDefault();fn(true);});
  el.addEventListener("pointerup",()=>fn(false));
}

if(isMobile){
  bind("gas",v=>gas=v);
  bind("brake",v=>brake=v);
  bind("left",v=>left=v);
  bind("right",v=>right=v);
}

/* GAME */
let speed=0, started=false;

document.getElementById("begin").onclick=()=>{
  document.getElementById("menu").style.display="none";
  started=true;
};

function loop(){
  requestAnimationFrame(loop);

  if(started){
    if(keys["w"]||gas) speed+=0.003;
    if(keys["s"]) speed-=0.003;
    if(keys[" "]||brake) speed*=0.85;

    speed*=0.98;
    speed=Math.max(Math.min(speed,0.35),-0.25);

    if(keys["a"]||left) car.position.x-=0.15;
    if(keys["d"]||right) car.position.x+=0.15;

    car.position.z-=speed*10;

    camera.position.lerp(
      new THREE.Vector3(car.position.x,4,car.position.z+8),0.12
    );
    camera.lookAt(car.position);

    document.getElementById("spd").textContent=Math.abs(speed*100|0);
  }

  renderer.render(scene,camera);
}

loop();

addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>

</body>
</html>
