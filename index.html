<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Endless Roads</title>
<style>
  body { margin:0; overflow:hidden; background:#000; }
  #ui {
    position:absolute; top:20px; left:20px;
    background:rgba(255,255,255,0.9);
    padding:14px; border-radius:10px;
    font-family:Arial;
  }
  button { width:120px; margin:4px 0; }
  #spd {
    position:absolute; top:20px; right:20px;
    background:#333; color:#fff;
    padding:8px 12px; border-radius:8px;
    font-family:monospace;
  }
</style>
</head>
<body>

<div id="ui">
  <b>Endless Roads</b><br><br>
  <button id="start">Start</button>
  <button id="pause">Pause</button><br><br>
  W/A/S/D – Drive<br>
  Space – Brake<br>
  C – Camera
</div>

<div id="spd">SPD 0</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152/build/three.min.js"></script>

<script>
// ===== BASIC SETUP =====
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0,4,8);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

window.onresize = () => {
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
};

// ===== LIGHT =====
scene.add(new THREE.HemisphereLight(0xffffff,0x444444,1));
const sun = new THREE.DirectionalLight(0xffffff,0.8);
sun.position.set(10,20,0);
scene.add(sun);

// ===== TERRAIN =====
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(2000,2000),
  new THREE.MeshLambertMaterial({color:0x6fdc6f})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// ===== ROAD =====
const roadGroup = [];
const TILE = 20;
const roadMat = new THREE.MeshStandardMaterial({color:0x222222});

function roadCurve(z){
  return Math.sin(z*0.01)*6;
}

for(let i=0;i<40;i++){
  const r = new THREE.Mesh(
    new THREE.PlaneGeometry(6,TILE),
    roadMat
  );
  r.rotation.x = -Math.PI/2;
  r.position.z = -i*TILE;
  scene.add(r);
  roadGroup.push(r);
}

// ===== CAR =====
const car = new THREE.Group();

// body
const body = new THREE.Mesh(
  new THREE.BoxGeometry(1.8,0.6,3.5),
  new THREE.MeshStandardMaterial({color:0xffffff})
);
body.position.y = 0.6;
car.add(body);

// wheels
function wheel(x,z){
  const w = new THREE.Mesh(
    new THREE.CylinderGeometry(0.35,0.35,0.4,16),
    new THREE.MeshStandardMaterial({color:0x111111})
  );
  w.rotation.z = Math.PI/2;
  w.position.set(x,0.35,z);
  car.add(w);
}
wheel(-0.9,1.2); wheel(0.9,1.2);
wheel(-0.9,-1.2); wheel(0.9,-1.2);

scene.add(car);

// ===== AUDIO =====
const sndIdle = new Audio("engine_idle.mp3");
const sndLow  = new Audio("engine_low.mp3");
const sndHigh = new Audio("engine_high.mp3");

[sndIdle,sndLow,sndHigh].forEach(s=>{
  s.loop = true;
  s.volume = 0;
});

// ===== INPUT =====
const keys = {};
onkeydown = e => keys[e.key.toLowerCase()] = true;
onkeyup   = e => keys[e.key.toLowerCase()] = false;

// ===== GAME STATE =====
let speed = 0;
let running = false;
let paused = false;
let camMode = 0;

// ===== UI =====
start.onclick = () => {
  running = true;
  sndIdle.play(); sndLow.play(); sndHigh.play();
};
pause.onclick = () => paused = !paused;

// ===== LOOP =====
function animate(){
  requestAnimationFrame(animate);
  if(!running || paused) return renderer.render(scene,camera);

  // speed
  if(keys["w"]) speed += 0.002;
  if(keys["s"]) speed -= 0.002;
  if(keys[" "]) speed *= 0.95;
  speed = THREE.MathUtils.clamp(speed,0,0.25);

  // steering (FIXED)
  if(keys["a"]) car.position.x += 0.12;
  if(keys["d"]) car.position.x -= 0.12;

  car.position.z -= speed;

  // road snapping
  const tx = roadCurve(car.position.z);
  car.position.x += (tx - car.position.x)*0.02;

  // road loop
  roadGroup.forEach(r=>{
    const c1 = roadCurve(r.position.z);
    const c2 = roadCurve(r.position.z+5);
    r.position.x = c1;
    r.rotation.z = Math.atan2(c2-c1,5);
    if(r.position.z - car.position.z > TILE*2)
      r.position.z -= TILE*roadGroup.length;
  });

  // camera
  if(keys["c"]) camMode = (camMode+1)%2;
  if(camMode===0){
    camera.position.lerp(new THREE.Vector3(
      car.position.x,4,car.position.z+8
    ),0.1);
  }else{
    camera.position.lerp(new THREE.Vector3(
      car.position.x,1.5,car.position.z+0.5
    ),0.1);
  }
  camera.lookAt(car.position);

  // ===== ENGINE SOUND MIX =====
  sndIdle.volume = speed < 0.02 ? 0.6 : 0;
  sndLow.volume  = speed>=0.02 && speed<0.12 ? 0.6 : 0;
  sndHigh.volume = speed>=0.12 ? 0.7 : 0;

  document.getElementById("spd").innerText = "SPD " + Math.floor(speed*400);

  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
