<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Endless Roads</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin:0;
  overflow:hidden;
  font-family:Arial, sans-serif;
}

/* UI */
#ui {
  position:fixed;
  top:20px;
  left:20px;
  background:#ffffffdd;
  padding:12px;
  border-radius:10px;
}
button {
  width:100%;
  margin-top:6px;
  padding:6px;
}

/* Mobile Controls */
#mobileControls {
  position:fixed;
  bottom:20px;
  left:0;
  right:0;
  display:none;
  justify-content:space-between;
  padding:0 20px;
}
.mBtn {
  width:70px;
  height:70px;
  border-radius:50%;
  border:none;
  background:rgba(0,0,0,0.6);
  color:white;
  font-size:26px;
}
</style>
</head>

<body>

<div id="ui">
  <b>Endless Roads</b><br>
  <button id="startBtn">Start</button>
  <div style="font-size:12px;margin-top:6px">
    W A S D | Space
  </div>
</div>

<div id="mobileControls">
  <div>
    <button class="mBtn" id="leftBtn">◀</button>
    <button class="mBtn" id="rightBtn">▶</button>
  </div>
  <div>
    <button class="mBtn" id="brakeBtn">⛔</button>
    <button class="mBtn" id="gasBtn">▲</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
/* ---------- DEVICE DETECT ---------- */
const isMobile = ('ontouchstart' in window);
if(isMobile){
  document.getElementById("mobileControls").style.display="flex";
}

/* ---------- SCENE ---------- */
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

let camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0,4,8);

let renderer = new THREE.WebGLRenderer({antialias:!isMobile});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

/* ---------- LIGHT ---------- */
scene.add(new THREE.HemisphereLight(0xffffff,0x444444,1));

/* ---------- GROUND ---------- */
let ground = new THREE.Mesh(
  new THREE.PlaneGeometry(500,500),
  new THREE.MeshStandardMaterial({color:0x66dd66})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

/* ---------- ROAD ---------- */
let road = new THREE.Mesh(
  new THREE.PlaneGeometry(20,500),
  new THREE.MeshStandardMaterial({color:0x333333})
);
road.rotation.x = -Math.PI/2;
road.position.y = 0.01;
scene.add(road);

/* ---------- CAR ---------- */
let car = new THREE.Mesh(
  new THREE.BoxGeometry(1.5,0.6,3),
  new THREE.MeshStandardMaterial({color:0xffffff})
);
car.position.y = 0.3;
scene.add(car);

/* ---------- INPUT ---------- */
let keys = {};
addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

let mLeft=false,mRight=false,mGas=false,mBrake=false;
function bind(id,cb){
  let b=document.getElementById(id);
  b.addEventListener("touchstart",e=>{e.preventDefault();cb(true)});
  b.addEventListener("touchend",e=>{e.preventDefault();cb(false)});
}
bind("leftBtn",v=>mLeft=v);
bind("rightBtn",v=>mRight=v);
bind("gasBtn",v=>mGas=v);
bind("brakeBtn",v=>mBrake=v);

/* ---------- GAME ---------- */
let speed=0;
let started=false;

document.getElementById("startBtn").onclick=()=>{
  started=true;
};

function animate(){
  requestAnimationFrame(animate);

  if(started){
    if(keys["w"]||mGas) speed+=0.002;
    if(keys["s"]) speed-=0.002;
    if(keys[" "]||mBrake) speed*=0.9;
    speed*=0.98;
    speed=Math.max(Math.min(speed,0.3),-0.1);

    if(keys["a"]||mLeft) car.position.x-=0.1;
    if(keys["d"]||mRight) car.position.x+=0.1;

    car.position.z-=speed*10;

    // stay on road area
    car.position.x=Math.max(Math.min(car.position.x,8),-8);

    camera.position.lerp(
      new THREE.Vector3(car.position.x,4,car.position.z+8),0.1
    );
    camera.lookAt(car.position);
  }

  renderer.render(scene,camera);
}
animate();

addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>

</body>
</html>
